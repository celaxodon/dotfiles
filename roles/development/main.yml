---
  - name: "Install dotfiles"
    hosts: localhost
    connection: local
    tasks:

    - name: "Install vim, tmux, git, zsh"
      ansible.builtin.package:
        name:
          - vim
          - git
          - tmux
          - zsh
        state: latest
      become: yes

    - name: "(legacy) Ensure vim config directory exists"
      ansible.builtin.file:
        path: ~/.vim
        state: directory
      tags:
        - vim

    - name: "Ensure nvim config directory exists"
      ansible.builtin.file:
        path: ~/.config/nvim
        state: directory
      tags:
        - vim

    - name: "Copy zsh config files into place"
      ansible.builtin.copy:
        src: files/zshrc
        dest: ~/.zshrc
        mode: 0744

    - name: "Get project's poetry venv location"
      ansible.builtin.shell: "poetry env list --full-path | grep 'Activated' | cut -d ' ' -f 1"
      register: poetry_venv_location
      tags:
        - vim

    - debug:
        msg: "{{ poetry_venv_location.stdout }}"

    - name: "Insert poetry venv location in nvim config file"
      set_fact:
        python3_venv_loc: "{{ poetry_venv_location.stdout }}/"
      tags:
        - vim

    - name: "(legacy) Copy vim config files into place"
      ansible.builtin.copy:
        src: files/vimrc
        dest: ~/.vim/vimrc
        mode: '0644'
      tags:
        - vim

    - name: "Create neovim config directory"
      ansible.builtin.file:
        path: ~/.config/nvim
        state: directory
      tags:
        - vim

    - name: "Copy neovim config file into place"
      ansible.builtin.template:
        src: templates/init.vim.j2
        dest: ~/.config/nvim/init.vim
        mode: '0644'
      tags:
        - vim

    - name: "Copy tmux config files into place"
      ansible.builtin.copy:
        src: files/tmux.conf
        dest: ~/.tmux/tmux.conf
        mode: '0644'

    - name: "Copy tmux startup script into place"
      ansible.builtin.copy:
        src: files/tmux_startup.sh
        dest: ~/.tmux/startup.sh
        mode: '0755'

    - name: "Copy global gitignore file"
      ansible.builtin.copy:
        src: files/gitignore_global
        dest: ~/.gitignore_global
        mode: '0644'

    - name: "Ensure ~/.ctags directory is present"
      ansible.builtin.file:
        path: ~/.ctags
        state: directory

    - name: "Copy elixir ctags file into place"
      ansible.builtin.copy:
        src: files/elixir.ctags
        dest: ~/.ctags/elixir.ctags
        mode: '0644'

    # FIXME
    # - name: "Install nvim plugins"
    #   ansible.builtin.shell: 'nvim +PlugInstall +qall && nvim +PlugClean +qall && nvim +PlugUpdate +qall'
